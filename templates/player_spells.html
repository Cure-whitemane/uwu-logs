{% extends "layout_report.html" %}

{% block scripts_head %}
<script src="/static/casts.js?v=1" defer></script>
{% endblock scripts_head %}

{% block add_style %}
<style>
main {
  padding-bottom: 5rem;
}
#flag-filter-wrap {
  position: fixed;
  bottom: var(--bottom-row-two);
  margin-inline: .3rem;
  margin-block: 1rem;
  z-index: 5;
}
#flag-filter-wrap > span {
  font-size: 150%;
  padding: .1em;
  padding-left: 1ch;
  border: .1em solid var(--primary-color);
  border-radius: .3em;
  background-color: var(--background)
}
#flag-filter-wrap > #flag-filter {
  visibility: hidden;
  position: absolute;
  bottom: 100%;
  left: 0;
  padding: .1rem;
  width: max-content;
  background-color: var(--background);
  box-shadow: inset 0 0 .5em var(--primary-color);
  border-radius: .5em;
}
#flag-filter-wrap:hover > #flag-filter {
  visibility: visible;
}
.flag-color-picker {
  width: 2em;
  border: none;
}
.flag-checkbox:checked + label {
  color: var(--secondary-color);
}

#spell-timeline-wrap {
  width: clamp(10rem, 100vw, 30rem);
  display: flex;
  justify-content: space-between;
}
#spell-timeline-mult {
  width: 100%;
}

#casts-section-wrap {
  --tenth-width: calc(var(--mult) * 1px);
  width: calc(var(--mult) * var(--duration) * 10px + 2px);
  margin-left: 2px;
}
.spell-row {
  --size: 1.15em;
}
.spell-row > div {
  height: var(--size);
  border: 1px solid var(--table-border);
  background-color: black;
}
.spell-row:nth-of-type(even) > div {
	background-color: hsl(0, 0%, 5%);
}

.spell-name {
  display: flex;
}
.spell-name::before {
  content: attr(data-count);
  text-align: right;
  display: inline-block;
  min-width: 4ch;
}
.spell-name img {
  min-width: var(--size);
  max-width: var(--size);
  min-height: var(--size);
  max-height: var(--size);
  padding-inline: .25em;
}
.spell-name a {
  overflow: hidden;
}
.spell-name div {
  position: relative;
  margin-left: auto;
}

.spell-history {
  position: relative;
}
.cleu {
  position: absolute;
  top: 0;
  left: var(--left);
  height: 100%;
  width: var(--tenth-width);
  background-color: currentColor;
  box-shadow: -1px 0 gainsboro;
}

#the-tooltip {
  position: absolute;
  width: fit-content;
  background-color: var(--background);
  text-align: center;
  padding: .5em;
  border-radius: 6px;
  box-shadow: inset 0 0 .25rem .1rem var(--primary-color), 0 0 .5rem .1rem var(--primary-color);
  z-index: 5;
}

.casts-table-timeline {
  padding-top: 1rem;
  background-color: black;
  margin-left: 1px;
}
.timeline-ruler-tick {
	position: relative;
	display: inline-block;
  box-shadow: -1px 1px currentColor;
	width: var(--tenth-width);
}
.timeline-ruler-second {
	height: 1rem;
}
.timeline-ruler-half-second {
	height: .75rem;
  font-size: 75%;
}
.timeline-ruler-tenth-second {
	height: .25rem;
  font-size: 50%;
}
.timeline-ruler-number {
  font-size: inherit;
	position: absolute;
  bottom: 100%;
  transform: translate(-50%, 0);
}

spells-hide > spell-row:first-of-type > * {
 border-top: 1px solid var(--primary-color);
}

spells-fav > spell-row:last-of-type > * {
 border-bottom: 1px solid var(--primary-color);
}

#aura-controls {
  position: absolute;
  top: 0;
  right: 0;
}
#aura-controls button {
  min-width: unset;
  font-size: 75%;
  padding: 0 .5em;
}
#spell-toggle-hidden + label {
  min-width: 11ch;
}
.hidden {
  visibility: hidden;
}
</style>
{% endblock add_style %}

{% block the_main %}
<main>
<section id="player-nav-wrap">
  <ul id="player-nav">
    <li><a href="/reports/{{ REPORT_ID }}/player/{{ SOURCE_NAME }}/{{ QUERY }}">DAMAGE</a></li>
    <li><a href="/reports/{{ REPORT_ID }}/heal/{{ SOURCE_NAME }}/{{ QUERY }}">HEAL</a></li>
    <li><a href="/reports/{{ REPORT_ID }}/taken/{{ SOURCE_NAME }}/{{ QUERY }}">TAKEN</a></li>
    <li><a href="/reports/{{ REPORT_ID }}/player_auras/{{ SOURCE_NAME }}/{{ QUERY }}">AURAS</a></li>
    <li><a href="/reports/{{ REPORT_ID }}/casts/{{ SOURCE_NAME }}/{{ QUERY }}">CASTS</a></li>
  </ul>
</section>
<section id="flag-filter-wrap">
  <span>FLAG FILTER ≡</span>
  <ul id="flag-filter">
    {% for flag in FLAGS %}
    <li>
      <input type="color" class="flag-color-picker">
      <input id="{{ flag }}" type="checkbox" class="flag-checkbox" checked>
      <label class="tab" for="{{ flag }}">{{ flag }}</label>
    </li>
    {% endfor %}
  </ul>
</section>
<section>
  <ul id="player-info">
    <li class="{{ PLAYER_CLASSES[SOURCE_NAME] }}" style="font-size: 300%;">{{ SOURCE_NAME }}</li>
    <li><a id="warmane-armory-link" href="http://armory.warmane.com/character/{{ SOURCE_NAME }}/{{ SERVER }}" target="_blank">Armory⇗</a></li>
  </ul>
</section>
<section id="spell-timeline-wrap">
  <span>ZOOM:</span>
  <input id="spell-timeline-mult" type="range" min="1" max="100" value="3">
  <span id="spell-timeline-mult-label">3x</span>
  <input id="spell-toggle-hidden" type="checkbox">
  <label for="spell-toggle-hidden">Show hidden</label>
</section>
<section class="table-wrap wrap-spell" style="display: none; --duration: {{ RDURATION }}">
  <div id="casts-section-wrap">
    <div class="casts-table-timeline" data-duration="{{ RDURATION }}"></div>
    <div class="casts-section">
      <spells-fav class="casts-section-fav"></spells-fav>
      <spells-main class="casts-section-main">
        {% for spell_id, _asdasd in DATA.items() %}
        <spell-row class="spell-row" data-spell-id="{{ spell_id }}" data-spell-name="{{ SPELLS[spell_id]['name'] }}">
          <div class="spell-name">
            <img src="https://wotlk.evowow.com/static/images/wow/icons/large/{{ SPELL_ICONS[spell_id] }}.jpg" alt="{{ spell_id }}">
            <a class="{{ SPELLS[spell_id]['color'] }}" href="/reports/{{ REPORT_ID }}/spell/{{ spell_id }}/{{ QUERY }}">{{ SPELLS[spell_id]['name'] }}</a>
            <div></div>
          </div>
          <div class="spell-history">
            {% for ts, from_start, flag, source, target, etc in _asdasd %}
            <div class="cleu {{ flag }}" style="--left: {{ ts }}%" data-time="{{ from_start }}" data-source="{{ source }}" data-target="{{ target }}" data-etc="{{ etc }}" data-pad="{{ ts }}"></div>
            {% endfor %}
          </div>
        </spell-row>
        {% endfor %}
      </spells-main>
      <spells-hide class="spells-hide" style="display: none;"></spells-hide>
    </div>
  </div>
</section>
<aside id="the-tooltip" style="display: none">
  <p id="tooltip-time"></p>
  <p id="tooltip-flag"></p>
  <p id="tooltip-source"></p>
  <p id="tooltip-target"></p>
  <p id="tooltip-data"></p>
</aside>
<aside id="aura-controls" style="display: none;">
  <button id="aura-top">⇅</button>
  <!-- <button id="aura-top">⇑</button> -->
  <button id="aura-del">✖</button>
  <!-- <button id="aura-up">▲</button> -->
  <!-- <button id="aura-down">▼</button> -->
</aside>
</main>
{% endblock the_main %}
