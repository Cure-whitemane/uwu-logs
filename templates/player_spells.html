{% extends "layout_report.html" %}

{% block scripts_head %}
<script src="/static/casts.js?v={{ V }}" defer></script>
{% endblock scripts_head %}

{% block add_style %}
<style>
main {
  padding-bottom: 5rem;
}
#graph-controls {
  background: var(--background);
  display: flex;
  gap: .25rem;
}

@media (orientation: portrait) {
  #graph-controls {
    position: fixed;
    left: 0;
    transform: translateY(-100%);
  }
}
#spell-toggle-hidden + label {
  padding: 0;
}

#flag-filter-wrap > div {
  min-width: 7em;
}
@media (orientation: landscape) {
  #flag-filter-wrap > div {
    padding-inline: 2em;
  }
}
#flag-filter-wrap > #flag-filter {
  visibility: hidden;
  position: absolute;
  bottom: 90%;
  padding: .1rem;
  width: max-content;
  background-color: var(--background);
  box-shadow: inset 0 0 .5em var(--primary-color);
  border-radius: .5em;
}
#flag-filter > li {
  text-align: left;
}
#flag-filter-wrap:hover > #flag-filter {
  visibility: visible;
}
.flag-color-picker {
  width: 2em;
  border: none;
}
.flag-checkbox:checked + label {
  color: var(--secondary-color);
}

#spell-timeline-mult {
  width: 100%;
}
#spell-timeline-mult-label {
  min-width: 4ch;
}

.casts-section {
  padding-top: 5rem;
}

#casts-section-wrap {
  --tenth-width: calc(var(--mult) * 1px);
  width: calc(var(--mult) * var(--duration) * 10px + 2px);
  margin-left: 2px;
}
.spell-row {
  --size: 1.15em;
  display: block;
}
.spell-row > div {
  height: var(--size);
  border: 1px solid var(--table-border);
  background-color: black;
}
.spell-row:nth-of-type(even) > div {
	background-color: hsl(0, 0%, 5%);
}

.spell-name {
  display: flex;
}
.spell-name::before {
  content: attr(data-count);
  text-align: right;
  display: inline-block;
  min-width: 4ch;
}
.spell-name img {
  min-width: var(--size);
  max-width: var(--size);
  min-height: var(--size);
  max-height: var(--size);
  padding-inline: .25em;
}
.spell-name a {
  overflow: hidden;
}
.spell-name div {
  position: relative;
  margin-left: auto;
}

.spell-history {
  position: relative;
}
spell-cleu {
  position: absolute;
  top: 0;
  left: var(--left);
  height: 100%;
  width: var(--tenth-width);
  background-color: currentColor;
  box-shadow: -1px 0 gainsboro;
}

#the-tooltip {
  position: absolute;
  width: fit-content;
  background-color: var(--background);
  text-align: center;
  padding: .5em;
  border-radius: 6px;
  box-shadow: inset 0 0 .25rem .1rem var(--primary-color), 0 0 .5rem .1rem var(--primary-color);
  z-index: 5;
}

#timeline-ruler {
  padding-top: 1rem;
  background-color: black;
  margin-left: 1px;
}
.timeline-ruler-tick {
	position: relative;
	display: inline-block;
  box-shadow: -1px 1px currentColor;
	width: var(--tenth-width);
}
.timeline-ruler-second {
	height: 1rem;
}
.timeline-ruler-half-second {
	height: .6rem;
  font-size: 75%;
}
.timeline-ruler-tenth-second {
	height: .25rem;
  font-size: 50%;
}
.timeline-ruler-number {
  font-size: inherit;
	position: absolute;
  bottom: 100%;
  transform: translate(-50%, 0);
}

spells-hide > spell-row:first-of-type > * {
 border-top: 1px solid var(--primary-color);
}

spells-fav > spell-row:last-of-type > * {
 border-bottom: 1px solid var(--primary-color);
}

#aura-controls {
  position: absolute;
  top: 0;
  right: 0;
}
#aura-controls button {
  min-width: unset;
  font-size: 75%;
  padding: 0 .5em;
}
#spell-toggle-hidden + label {
  min-width: 11ch;
}

.player-name {
  font-size: 300%;
}

.player-info {
  display: flex;
  align-items: baseline;
  gap: 1rem;
}

#spells-fav > .char-0 > * {
  background-color: hsl(0, 0%, 0%);
}
#spells-fav > .char-1 > * {
  background-color: hsl(271, 100%, 10%);
}
#spells-fav > .char-2 > * {
  background-color: hsl(0, 100%, 10%);
}
.char-tab {
  display: block;
  font-size: 300%;
  max-width: 30ch;
}
.char-report-id {
  display: block;
}
#tabs-wrap {
  display: grid;
  grid-column-gap: 1rem;
  grid-auto-flow: column;
  padding-bottom: 1rem;
}
#tabs-wrap > div {
  display: grid;
  border: 2px solid var(--primary-color);
  border-radius: 1rem 1rem auto auto;
}
.char-report-id {
  grid-column: span 3;
}
.char-tab {
  grid-column: span 4;
}
@media (orientation: portrait) {
  #tabs-wrap {
    grid-auto-flow: row;
  }
}
#add-character {
  font-size: 350%;
}
dialog {
  background-color: var(--background);
  border: none;
  box-shadow: inset 0 0 .5em var(--primary-color);
  border-radius: .5em;
  left: 50%;
  top: 50%;
  transform:translate(-50%, -50%);
}
dialog select {
  font-size: 200%;
}
#boss-reminder {
  font-size: 500%;
}
</style>
{% endblock add_style %}

{% block the_main %}
<main>
<section id="player-nav-wrap">
  <ul id="player-nav">
    <li><a href="/reports/{{ REPORT_ID }}/player/{{ SOURCE_NAME }}/{{ QUERY }}">DAMAGE</a></li>
    <li><a href="/reports/{{ REPORT_ID }}/heal/{{ SOURCE_NAME }}/{{ QUERY }}">HEAL</a></li>
    <li><a href="/reports/{{ REPORT_ID }}/taken/{{ SOURCE_NAME }}/{{ QUERY }}">TAKEN</a></li>
    <li><a href="/reports/{{ REPORT_ID }}/player_auras/{{ SOURCE_NAME }}/{{ QUERY }}">AURAS</a></li>
    <li><a href="/reports/{{ REPORT_ID }}/casts/{{ SOURCE_NAME }}/{{ QUERY }}">CASTS</a></li>
    <li id="graph-controls">
      <section id="flag-filter-wrap">
        <div>≡ FLAG FILTER</div>
        <ul id="flag-filter">
          {% for flag in FLAG_ORDER %}
          <li id="{{ flag }}" style="display: none;">
            <input type="color" class="flag-color-picker">
            <input id="{{ flag }}_CHECKBOX" type="checkbox" class="flag-checkbox" checked>
            <label class="tab" for="{{ flag }}_CHECKBOX">{{ flag }}</label>
          </li>
          {% endfor %}
        </ul>
      </section>
      <span>ZOOM:</span>
      <input id="spell-timeline-mult" type="range" min="1" max="100" value="3">
      <span id="spell-timeline-mult-label">3x</span>
      <input id="spell-toggle-hidden" type="checkbox">
      <label for="spell-toggle-hidden">Show hidden</label>
    </li>
  </ul>
</section>
<section id="boss-reminder" style="display: none;">Select boss to see casts.</section>
<section id="tabs-wrap" style="display: none;">
  <button id="add-character">+</button>
</section>
<section class="table-wrap wrap-spell" style="display: none;">
  <div id="casts-section-wrap">
    <div id="timeline-ruler"></div>
    <div id="spells-fav"></div>
  </div>
</section>
<aside id="the-tooltip" style="display: none">
  <p id="tooltip-time"></p>
  <p id="tooltip-flag"></p>
  <p id="tooltip-source"></p>
  <p id="tooltip-target"></p>
  <p id="tooltip-data"></p>
</aside>
<aside id="aura-controls" style="display: none;">
  <button id="button-fav">▲</button>
  <button id="button-del">✖</button>
</aside>

<dialog id="add-character-dialog">
    <p id="dialog-msg" style="visibility: hidden;">Report wasn't found</p>
    <p>
      <input id="input-report-id" type="text" placeholder="Input report ID">
      <button id="fetch-report-slices" type="button">Load</button>
    </p>
    <p id="select-attempts-wrap">
      <span>Select attempt:</span>
      <select id="select-attempts"></select>
    </p>
    <p id="select-players-wrap">
      <span>Select player:</span>
      <select id="select-players"></select>
    </p>
    <div>
      <button id="button-cancel" >Cancel</button>
      <button id="button-confirm" value="default" style="visibility: hidden;">Confirm</button>
    </div>
</dialog>

</main>
{% endblock the_main %}
