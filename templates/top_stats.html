{% extends "layout.html" %}
{% block scripts_head %}
<script type="module" src="static/pve_stats.js?v={{ V }}"></script>
{% endblock scripts_head %}
{% block add_style %}
<style>
main {
  position: unset;
}
img {
	min-height: 1em;
	max-height: 1em;
	min-width: 1em;
	max-width: 1em;
	vertical-align: middle;
	margin-bottom: 1px;
  margin-inline: .25em;
}
section > div {
  --left-column: 9rem;
  position: relative;
}
@media (orientation: landscape) {
  section > div {
    margin-inline: 10rem;
  }
}
table {
  width: 100%;
}
.stats-cell-name {
  min-width: var(--left-column);
  width: var(--left-column);
  max-width: var(--left-column);
  color: inherit;
}
.stats-cell-data {
  position: relative;
  color: inherit;
}
.stats-cell-data div {
	position: absolute;
  bottom: 0;
  width: .2em;
	height: 1em;
  z-index: 2;
}
.passthrudiv,
.max,
.p10 {
  color: inherit;
  background-color: currentColor;
}
.p95 {
  background-color: lime;
}
.p90 {
  background-color: lawngreen;
}
.p75 {
  background-color: yellow;
}
.p50 {
  background-color: orange;
}
.stats-cell-data :is(.p10, .max) {
  height: .5em;
  transform: translateY(-50%);
}
.stats-cell-data .passthrudiv {
  height: .2em;
  transform: translateY(-200%);
}

#chart-timeline-wrap {
  position: absolute;
  left: var(--left-column);
  top: 0;
  right: 0;
  bottom: 0;
}
.chart-column {
  position: absolute;
  width: .1em;
  left: 1%;
  top: 0;
  bottom: 0;
  background-color: var(--table-border);
  z-index: 1;
}
.chart-column::after {
	content: attr(data-dps);
	position: fixed;
	transform: translate(-40%, -100%);
}
@media (orientation: portrait) {
  .chart-column:nth-child(even):after {
    visibility: hidden;
  }
}

#table-info {
  display: flex;
  flex-direction: row;
  justify-content: space-evenly;
}
@media (max-width: 1600px) {
  #table-info button {
    font-size: 75%;
  }
}
#table-info button span {
  display: inline-block;
  height: 1em;
  width: 1em;
}

#stats-section {
  margin-top: 2rem;
}
#select-boss {
  min-width: 26ch;
}
#controls * {
  font-size: 150%;
}

#the-tooltip {
  position: absolute;
  width: fit-content;
  background-color: var(--background);
  padding: .5em;
  border-radius: 6px;
  box-shadow: inset 0 0 .25rem .1rem var(--primary-color), 0 0 .5rem .1rem var(--primary-color);
	transform: translateX(-100%);
  z-index: 5;
}
#the-tooltip p {
  display: flex;
  justify-content: space-between;
  gap: 1rem;
}
#the-tooltip .percentile {
  width: 6ch;
  text-align: right;
}
#the-tooltip .npoints {
  width: 5ch;
  text-align: right;
}
#the-tooltip td:first-of-type {
  min-width: 8ch;
  text-align: left;
}
#the-tooltip .p95 td {
  background-color: hsl(120, 100%, 10%);
}
#the-tooltip .p90 td {
  background-color: hsl(90, 100%, 10%);
}
#the-tooltip .p75 td {
  background-color: hsl(60, 100%, 10%);
}
#the-tooltip .p50 td {
  background-color: hsl(39, 100%, 10%);
}

#select-server {grid-area: serv;}
#select-instance {grid-area: inst;}
#select-boss {grid-area: boss;}
#select-mode {grid-area: size;}
#difficulty-label {grid-area: diff;}
#submit-button {grid-area: subm;}
#controls {
  display: grid;
  grid-template-areas:
  'inst inst inst inst inst inst'
  'boss boss boss boss boss boss'
  'serv serv size diff subm subm';
  gap: .5rem;
}
@media (min-width: 1100px) {
  #controls {
    margin-inline: 10rem;
    display: flex;
    justify-content: space-between;
    margin-inline: 10rem;
  }
}
</style>
{% endblock add_style %}

{% block the_main %}
<main>
  <section id="controls">
    <select id="select-server">
      {% for server in SERVERS %}
      <option value="{{ server }}">{{ server }}</option>
      {% endfor %}
    </select>
    <select id="select-instance">
    </select>
    <select id="select-boss">
    </select>
    <select id="select-mode">
      <option value="25">25</option>
      <option value="10">10</option>
    </select>
    <input id="difficulty-checkbox" type="checkbox" checked>
    <label id="difficulty-label" for="difficulty-checkbox">Heroic</label>
    <button id="submit-button" type="submit">Submit</button>
  </section>
	<section id="stats-section">
    <div>
      <div id="chart-timeline-wrap"></div>
      <table>
        <tbody id="stats-tbody">
          {% for spec_info in SPECS_BASE %}
          <tr class="stats-cell-row {{ spec_info['class_html'] }}" id="{{ spec_info['spec_html'] }}" data-class="{{ spec_info['class_name'] }}" data-spec="{{ spec_info['spec_name'] }}">
            <td class="stats-cell-name" title="{{ spec_info['class_name'] }}"><img src="/static/icons/{{ spec_info['icon'] }}.jpg">{{ spec_info['spec_name']  }}</td>
            <td class="stats-cell-data"></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div id="table-info">
      <button data-sort-by="data-p10-p">|——Bottom 50%——</button>
      <button data-sort-by="data-p50-p"><span class="p50"></span>50-75</button>
      <button data-sort-by="data-p75-p"><span class="p75"></span>75-95</button>
      <button data-sort-by="data-p90-p"><span class="p90"></span>75-95</button>
      <button data-sort-by="data-p95-p"><span class="p95"></span>95-99</button>
      <button data-sort-by="data-p99-p">———Top 1%———|</button>
    </div>
	</section>
  <aside id="the-tooltip" style="display: none;">
    <table>
      <thead>
        <tr><td colspan="3" id="tooltip-spec-info"></td></tr>
        <tr><td></td><td class="npoints">n</td><td class="percentile">DPS</td></tr>
      </thead>
      <tbody id="tooltip-body">
        <tr class="max"><td>Top 1:</td><td class="npoints"></td><td class="percentile"></td></tr>
        <tr class="p99"><td>Top 1%:</td><td class="npoints"></td><td class="percentile"></td></tr>
        <tr class="p95"><td>Top 5%:</td><td class="npoints"></td><td class="percentile"></td></tr>
        <tr class="p90"><td>Top 10%:</td><td class="npoints"></td><td class="percentile"></td></tr>
        <tr class="p75"><td>Top 25%:</td><td class="npoints"></td><td class="percentile"></td></tr>
        <tr class="p50"><td>Top 50%:</td><td class="npoints"></td><td class="percentile"></td></tr>
        <tr class="p10"><td>Low 10%:</td><td class="npoints"></td><td class="percentile"></td></tr>
        <tr class="all"><td>Total:</td><td class="npoints"></td><td class="percentile"></td></tr>
      </tbody>
    </table>
  </aside>
</main>
{% endblock the_main %}
