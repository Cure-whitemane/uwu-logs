{% extends "layout_report.html" %}

{% block add_style %}
<style>
img {
  display: inline-block;
  vertical-align: text-bottom;
  max-height: 1.1em;
  max-width: 1.1em;
  min-height: 1.1em;
  min-width: 1.1em;
}

.rectangle-cell {
  width: 12rem;
}
.points,
.rectangle-cell,
th {
  border-left: 10px solid var(--table-border);
}

.points {
  min-width: 3rem;
  width: 3rem;
  text-align: right;
}
.top100 {color: #e5cc80;}
.top99 {color: #e268a8;}
.top95 {color: #ff8000;}
.top75 {color: #a335ee;}
.top50 {color: #0070ff;}
.top25 {color: #1eff00;}
.top0 {color: #666666;}

.damage {
  display: none;
}
.swap {
  position: absolute;
  right: 0;
  padding-inline: .2em;
  font-weight: 600;
}
.sortable {
  position: relative;
}

.percent-bar {
  width: var(--width);
  height: 1em;
  border-radius: 0.1em;
}
.useful .percent-bar,
.damage .percent-bar,
.taken .percent-bar {
  background-color: hsl(0, 100%, 30%);
  box-shadow: .1em .1em 1em darkred;
}
.heal .percent-bar,
.heal_total .percent-bar {
  background-color: hsl(120, 100%, 25%);
  box-shadow: .1em .1em 1em forestgreen;
}

#chart-wrap {
  height: 20vh;
  width: 100%;
}
#chart {
  height: 100;
  width: 100%;
}
</style>
{% endblock add_style %}

{% block scripts_head %}
<script src="/static/chart-4.1.2.min.js"></script>
<script defer src="/static/report_main.js"></script>
<script defer src="/static/range.js"></script>
{% endblock scripts_head %}

{% block the_main %}
<main id="report-main">
  <section class="table-wrap wrap-player">
    <div>
      <table class="add-player-rank">
        <thead>
          <tr>
            <th class="player-cell">Name</th>
            <th class="points sortable"></th>
            <th class="useful sortable" colspan="3">Useful Damage<button class="swap swap-damage">⇄</button></th>
            <th class="damage sortable" colspan="3">Total Damage<button class="swap swap-damage">⇄</button></th>
            <th class="heal sortable" colspan="3">Heal<button class="swap swap-heal">⇄</button></th>
            <th class="heal_total sortable" colspan="3">Total heal<button class="swap swap-heal">⇄</button></th>
            <th class="taken sortable" colspan="3">Damage Taken</th>
          </tr> 
        </thead>
        <tbody class="table-has-total">
          {% for player_name, (spec_name, spec_icon) in SPECS.items() %}
          <tr>
            <td class="player-cell" title="{{ spec_name }}">
              <img src="/static/icons/{{ spec_icon }}.jpg">
              {% if player_name == "Total" %}Total
              {% else %}
              <a class="{{ PLAYER_CLASSES[player_name] }}" href="/reports/{{ REPORT_ID }}/player/{{ player_name }}/{{ QUERY }}">{{ player_name }}</a>
              {% endif %}
            </td>
            <td class="points total-cell">{{ POINTS[player_name] }}</td>
            {% for _type, players in DATA.items() %}
            <td class="{{ _type }} rectangle-cell">
              {% if players.get(player_name) %}
              <div class="percent-bar" style="--width: {{ players.get(player_name, {})['percent'] }}%"></div>
              {% endif %}
            </td>
            <td class="{{ _type }} total-cell">{{ players.get(player_name, {})['value'] }}</td>
            <td class="{{ _type }} per-sec-cell">{{ players.get(player_name, {})['per_second'] }}</td>
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
  <section id="chart-wrap" style="display: none;">
    <canvas id="chart"></canvas>
  </section>
  <div class="min-max-slider" data-legendnum="2">
    <div class="min-max-slider-inputs">
      <input class="min min-max-slider-half" name="min" type="range" step="1"/>
      <input class="max min-max-slider-half" name="max" type="range" step="1"/>
    </div>
    <div class="min-max-slider-values">
      <span class="min-value"></span>
      <span> - </span>
      <span class="max-value"></span>
      <span class="total-value"></span>
    </div>
    <button class="min-max-slider-submit" type="submit">Slice</button>
  </div>
  <section style="display: none;">
    <p>First Hit: {{ FIRST_HIT }}</p>
    <p>Last Hit: {{ LAST_HIT }}</p>
  </section>
</main>

{% endblock the_main %}
